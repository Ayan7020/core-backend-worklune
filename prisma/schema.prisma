generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model User {
  id            String    @id @default(uuid())
  email         String    @unique
  name          String?
  avatarUrl     String?
  emailVerified DateTime?

  passwordHash String?
  salt         String?
  googleSub    String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  memberships       Membership[]
  createdWorkspaces Workspace[]      @relation("WorkspaceCreator")
  refreshTokens     RefreshToken?
  projects          Projects[]
  projectMembers    ProjectMembers[]
  invitations       Invitation[]
  tasks             Task[]
  userSetting       UserSetting?
}

model UserSetting {
  id                 String @id @default(uuid())
  userId             String @unique
  defaultWorkspaceId String

  user      User      @relation(fields: [userId], references: [id])
  workspace Workspace @relation(fields: [defaultWorkspaceId], references: [id])
}

model RefreshToken {
  id        String   @id @default(uuid())
  userId    String   @unique()
  tokenHash String   @unique
  expiresAt DateTime
  createdAt DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

model Invitation {
  id          String @id @default(uuid())
  workspaceId String
  userId      String
  role        Role
  invitedById String

  status InvitationStatus @default(PENDING)

  expiresAt   DateTime
  respondedAt DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user      User      @relation(fields: [userId], references: [id])
  workspace Workspace @relation(fields: [workspaceId], references: [id])

  @@unique([workspaceId, userId])
}

model Membership {
  id String @id @default(uuid())

  userId      String
  workspaceId String

  role Role

  user      User      @relation(fields: [userId], references: [id])
  workspace Workspace @relation(fields: [workspaceId], references: [id])

  createdAt DateTime @default(now())

  @@unique([userId, workspaceId])
}

model Workspace {
  id   String @id @default(uuid())
  name String
  slug String @unique

  status WorkspaceStatus @default(ACTIVE)

  createdById String
  createdBy   User   @relation("WorkspaceCreator", fields: [createdById], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  memberships  Membership[]
  projects     Projects[]
  subscription Subscription?
  invitations  Invitation[]
  userSettings UserSetting[]
}

model Subscription {
  id          String @id @default(uuid())
  worspace_id String @unique

  plan WorkspacePlan @default(FREE)

  currentPeriodStart DateTime?
  currentPeriodEnd   DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  workspace Workspace @relation(fields: [worspace_id], references: [id])
}

model Projects {
  id String @id @default(uuid())

  workspaceId String
  createdById String

  name        String
  description String
  status      ProjectStatus @default(ACTIVE)
  color       ProjectColor  @default(ORANGE_DARK)
  createdAt   DateTime      @default(now())

  createdBy      User             @relation(fields: [createdById], references: [id])
  workspace      Workspace        @relation(fields: [workspaceId], references: [id])
  projectMembers ProjectMembers[]
  tasks          Task[]

  @@unique([workspaceId, name])
}

model ProjectMembers {
  id String @id @default(uuid())

  projectId String
  userId    String

  role ProjectRole @default(MEMBER)

  projects Projects @relation(fields: [projectId], references: [id])
  user     User     @relation(fields: [userId], references: [id])

  @@unique([projectId, userId])
}

model Task {
  id String @id @default(uuid())

  projectId   String
  createdById String

  assigneeId String

  status TaskStatus

  title       String
  description String
  tag         String

  priority TaskPriority

  user     User     @relation(fields: [createdById], references: [id])
  projects Projects @relation(fields: [projectId], references: [id])
}

enum ProjectColor {
  ORANGE
  BLUE
  GREEN
  PURPLE
  YELLOW
  PINK
  CYAN
  ORANGE_DARK
}

enum Role {
  OWNER
  ADMIN
  MEMBER
}

enum InvitationStatus {
  PENDING
  ACCEPTED
  DECLINED
  EXPIRED
  REVOKED
}

enum ProjectStatus {
  ACTIVE
  COMPLETED
}

enum WorkspaceStatus {
  ACTIVE
  SUSPENDED
  DELETED
}

enum WorkspacePlan {
  FREE
  PRO
  ENTERPRISE
}

enum ProjectRole {
  OWNER
  MAINTAINER
  MEMBER
}

enum TaskStatus {
  TODO
  IN_PROGRESS
  BLOCKED
  DONE
}

enum TaskPriority {
  URGENT
  HIGH
  LOW
}
